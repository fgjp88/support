{
  "metadata": {
    "character_name": "mvuÏÉÅÌÉúÏ∞Ω_bubble",
    "extracted_at": "2026-02-15T22:31:53.288Z",
    "extractor_version": "1.0",
    "injector_compatible_version": "1.0",
    "total_items": 9
  },
  "scripts": [
    {
      "name": " mvu_zod",
      "content": "import 'https://testingcf.jsdelivr.net/gh/MagicalAstrogy/MagVarUpdate/artifact/bundle.js'\n",
      "enabled": false,
      "id": "526a5807-1279-40cb-aa01-25b479a0572f",
      "type": "script"
    },
    {
      "name": "zod",
      "content": "import { registerMvuSchema } from 'https://testingcf.jsdelivr.net/gh/StageDog/tavern_resource/dist/util/mvu_zod.js';\n\nexport const Schema = z.object({\n  // 1. UI Labels (New!)\n  // ÌòÑÏû¨ Ïñ∏Ïñ¥Ïóê ÎßûÏ∂∞ UI ÌÖçÏä§Ìä∏Î•º ÏûêÎèô Î≤àÏó≠Ìï©ÎãàÎã§.\n  InterfaceLabels: z.object({\n    Title: z.string().describe('Main Title (e.g., \"MENTAL SCAN\", \"Ï†ïÏã† Î∂ÑÏÑù\", \"Á≤æÁ•ûÂàÜÊûê\")'),\n    \n    // [Ï∂îÍ∞Ä] SnapshotTimeÏùÄ Î≥ÑÎèÑ Î≥ÄÏàòÎ°ú Î∂ÑÎ¶¨ ÏöîÏ≤≠ÌïòÏÖ®ÏúºÎØÄÎ°ú UI LabelsÏóêÎäî Î≤ÑÌäº/ÌÉÄÏù¥ÌãÄ ÌÖçÏä§Ìä∏Îßå Ïú†ÏßÄÌï©ÎãàÎã§.\n    \n    Stability: z.string().describe('Label for Stability button (e.g., \"STABILITY\", \"ÏïàÏ†ïÎèÑ\")'),\n    \n    // [Ï∂îÍ∞Ä] ÎàÑÎùΩÎêòÏóàÎçò Coherence ÎùºÎ≤® Ï∂îÍ∞Ä\n    Coherence: z.string().describe('Label for Coherence button (e.g., \"COHERENCE\", \"Ïù¥ÏÑ±\", \"ÌÜµÌï©ÎèÑ\")'),\n    \n    Stream: z.string().describe('Label for Thought Stream button (e.g., \"STREAM\", \"ÏùòÏãùÏùò ÌùêÎ¶Ñ\")'),\n    Suppressed: z.string().describe('Label for Suppressed Memory button (e.g., \"TRAUMA\", \"ÏñµÏïï\")'),\n  }).describe('UI Interface text localized to the current narrative language'),\n\n  // [Ï∂îÍ∞Ä] 2. Snapshot Time (ÏãúÍ∞Ñ Ïä§ÎÉÖÏÉ∑)\n  // ÌåêÌÉÄÏßÄ/SF/ÌòÑÎåÄÎ¨º Î™®Îëê ÎåÄÏùë Í∞ÄÎä•Ìïú Î¨∏ÏûêÏó¥ Ìè¨Îß∑\n  SnapshotTime: z.string().describe('Current in-world time string. If modern, follow ST time. If fantasy/SF, generate fitting format (e.g., \"Year 402, Cycle 5\").'),\n\n  // 3. MentalState (Ï†ïÏã† ÏÉÅÌÉú)\n  MentalState: z.object({\n    Stability: z.coerce.number().min(0).max(100).describe('0-100: Psychological Stability'),\n    Coherence: z.coerce.number().min(0).max(100).describe('0-100: Logical Coherence'),\n  }),\n\n  // 4. Emotions (Í∞êÏ†ï)\n  Emotions: z.record(\n    z.string().describe('Emotion Name (MUST be in the narrative language)'),\n    z.coerce.number().min(0).max(100)\n  ).describe('Dominant emotions felt right now. Keys must match the story language.'),\n\n  // 5. SuppressedSectors (ÏñµÏïïÎêú Í∏∞Ïñµ/Ìä∏ÎùºÏö∞Îßà)\n  // ÎπÑÏñ¥ÏûàÏúºÎ©¥(Empty) HTMLÏóêÏÑú Î≤ÑÌäºÏùÑ ÏïÑÏòà Ïà®Í∏∏ ÏòàÏ†ïÏûÖÎãàÎã§.\n  SuppressedSectors: z.array(\n    z.object({\n      title: z.string().describe('Title of the memory'),\n      type: z.enum(['locked', 'corrupted']),\n      desc: z.string().describe('Visible description'),\n      content: z.string().describe('Hidden content shown on click'),\n    })\n  ).describe('List of triggered traumas. Return empty array [] if none.'),\n\n  // 6. ThoughtStream (ÏùòÏãùÏùò ÌùêÎ¶Ñ)\n  ThoughtStream: z.array(z.string())\n    .describe('Fleeting subconscious thoughts. MUST be in the narrative language.'),\n});\n\n$(() => {\n  registerMvuSchema(Schema);\n});",
      "enabled": false,
      "id": "4af988bd-bd73-4832-a651-f960ac592977",
      "type": "script"
    }
  ],
  "regexes": [
    {
      "id": "80cd5185-d0c7-4626-87bd-91f001a4742d",
      "script_name": "Ïä§ÌÉØÏ∞Ω-js",
      "enabled": true,
      "find_regex": "<StatusPlaceHolderImpl/>",
      "replace_string": "```html\n<!DOCTYPE html>\n<html lang=\"ko\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, user-scalable=no\">\n    <title>Mental Topology Analysis</title>\n    <style>\n        @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Orbitron:wght@400;700;900&display=swap');\n        \n        :root {\n            --primary-color: #00ff9d; /* Ï¥àÎ°ù (ÏïàÏ†ï) */\n            --bg-color: #0a0a0f;\n            --alert-color: #ff0040;   /* Îπ®Í∞ï (ÏúÑÌóò) */\n            --info-color: #0080ff;    /* ÌååÎûë (Ïö∞Ïö∏) */\n            --warn-color: #ff9d00;\n            --off-color: #333333;\n        }\n\n        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }\n        \n        body { \n            background: var(--bg-color); \n            color: var(--primary-color); \n            font-family: 'Share Tech Mono', monospace; \n            padding: 15px; \n            overflow-x: hidden; \n        }\n        \n        .dashboard {\n            max-width: 600px; \n            margin: 0 auto; \n            background: rgba(0, 255, 157, 0.03);\n            border: 2px solid rgba(0, 255, 157, 0.25);\n            position: relative; \n            overflow: hidden;\n            transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);\n            min-height: 50px;\n        }\n        \n        .dashboard.offline {\n            border-color: var(--off-color);\n            background: rgba(0, 0, 0, 0.8);\n        }\n        .dashboard.offline .title { color: var(--off-color); text-shadow: none; }\n        .dashboard.offline .header { border-bottom-color: var(--off-color); }\n\n        .dashboard.collapsed .bubble-canvas { height: 0; opacity: 0; pointer-events: none; }\n        .dashboard.collapsed .toggle-icon { transform: rotate(0deg); }\n        \n        .dashboard::before {\n            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%;\n            background: repeating-linear-gradient(0deg, rgba(0, 255, 157, 0.03) 0px, transparent 1px, transparent 2px, rgba(0, 255, 157, 0.03) 3px);\n            pointer-events: none; z-index: 100; animation: scanline 8s linear infinite;\n        }\n        @keyframes scanline { 0% { transform: translateY(0); } 100% { transform: translateY(10px); } }\n        \n        .header {\n            background: rgba(0, 0, 0, 0.7); padding: 12px 15px; border-bottom: 2px solid var(--primary-color);\n            position: relative; z-index: 10; cursor: pointer; user-select: none; transition: background 0.3s ease;\n        }\n        .header:hover { background: rgba(0, 255, 157, 0.1); }\n        .title {\n            font-family: 'Orbitron', monospace; font-size: 1.1em; font-weight: 900; letter-spacing: 2px;\n            color: var(--primary-color); text-shadow: 0 0 15px rgba(0, 255, 157, 0.5);\n            display: flex; align-items: center; gap: 10px;\n        }\n        .toggle-icon { font-size: 0.8em; transition: transform 0.3s ease; transform: rotate(180deg); }\n        .timestamp { position: absolute; top: 12px; right: 15px; font-size: 0.65em; color: rgba(0, 255, 157, 0.4); }\n        \n        .bubble-canvas {\n            height: 400px; position: relative; background: radial-gradient(circle at center, rgba(0, 255, 157, 0.08), transparent);\n            overflow: hidden; transition: height 0.4s ease, opacity 0.4s ease;\n        }\n        \n        .screen {\n            position: absolute; top: 0; left: 0; width: 100%; height: 100%; \n            opacity: 0; pointer-events: none; transition: opacity 0.4s ease; \n            overflow-y: auto; overflow-x: hidden; \n        }\n        .screen.active { opacity: 1; pointer-events: auto; z-index: 2; }\n        \n        /* [Ïä§ÌÅ¨Î°§Î∞î Ï†úÍ±∞ Ïú†ÏßÄ] */\n        #screen-stability { overflow: hidden !important; }\n        #screen-consciousness { overflow: hidden !important; }\n\n        .screen::-webkit-scrollbar { width: 8px; }\n        .screen::-webkit-scrollbar-track { background: rgba(0, 0, 0, 0.3); border-left: 1px solid rgba(0, 255, 157, 0.25); }\n        .screen::-webkit-scrollbar-thumb { background: rgba(0, 255, 157, 0.3); border-radius: 4px; }\n\n        /* Bubbles */\n        .bubble {\n            position: absolute; \n            border-radius: 50%; \n            display: flex; align-items: center; justify-content: center; \n            text-align: center; font-weight: bold; cursor: pointer; \n            transition: all 0.3s ease; \n            backdrop-filter: blur(5px); user-select: none; touch-action: manipulation; will-change: transform;\n            /* ÏÑ†Î™ÖÎèÑ Ïú†ÏßÄ */\n            text-shadow: 0 0 5px currentColor;\n            box-shadow: 0 0 5px rgba(0,0,0,0.5);\n        }\n        \n        /* [Ìò∏Î≤Ñ Ïù¥ÌéôÌä∏ Ïú†ÏßÄ] */\n        .bubble:active { transform: translate(-50%, -50%) scale(0.95) !important; }\n        .bubble:hover { \n            z-index: 100 !important; \n            transform: translate(-50%, -50%) scale(1.15); \n            /* ÎÇ¥Î∂Ä/Ïô∏Î∂Ä 2Ï§ë Î∞úÍ¥ë Ìö®Í≥º */\n            box-shadow: 0 0 20px currentColor, inset 0 0 10px currentColor !important;\n        }\n\n        /* Í∞êÏ†ï ÏÉÅÌÉúÎ≥Ñ Ïä§ÌÉÄÏùº */\n        .bubble.emotion { \n            border-width: 2px; \n            border-style: solid;\n            animation: float-complex 6s ease-in-out infinite; \n        }\n        \n        /* ÏÉÅÌÉú: Ï†ïÏÉÅ (Green) */\n        .bubble.emotion.state-normal {\n            border-color: var(--primary-color);\n            background: rgba(0, 255, 157, 0.15);\n            color: var(--primary-color);\n        }\n        /* ÏÉÅÌÉú: Ïπ®Ï†Ñ (Blue) */\n        .bubble.emotion.state-low {\n            border-color: var(--info-color);\n            background: rgba(0, 128, 255, 0.15);\n            color: var(--info-color);\n        }\n        /* ÏÉÅÌÉú: Í≤©Ïïô (Red) */\n        .bubble.emotion.state-high {\n            border-color: var(--alert-color);\n            background: rgba(255, 0, 64, 0.15);\n            color: var(--alert-color);\n        }\n\n        /* Î©îÎâ¥ Î≤ÑÌäº (ÎëêÍªçÍ≤å) */\n        .bubble.trigger { \n            animation: float-complex 8s ease-in-out infinite; \n            border-width: 3px; \n            border-style: solid;\n            z-index: 10;\n        }\n        \n        @keyframes float-complex {\n            0%, 100% { transform: translate(-50%, -50%) translate(0, 0) rotate(0deg); }\n            25% { transform: translate(-50%, -50%) translate(5px, -8px) rotate(2deg); }\n            50% { transform: translate(-50%, -50%) translate(-3px, -15px) rotate(-1deg); }\n            75% { transform: translate(-50%, -50%) translate(-7px, -8px) rotate(1deg); }\n        }\n        \n        .bubble:nth-child(2n) { animation-delay: -1.5s; }\n        .bubble:nth-child(3n) { animation-delay: -3.2s; }\n        \n        .sub-screen { padding: 20px; }\n        .back-btn {\n            background: rgba(0, 255, 157, 0.1); border: 2px solid rgba(0, 255, 157, 0.4);\n            color: var(--primary-color); padding: 8px 16px; cursor: pointer;\n            font-family: 'Share Tech Mono', monospace; font-size: 0.85em;\n            margin-bottom: 15px; display: inline-block;\n        }\n        .screen-title {\n            font-family: 'Orbitron', monospace; font-size: 1.1em; font-weight: 700;\n            margin-bottom: 15px; color: var(--primary-color); letter-spacing: 2px;\n            border-left: 3px solid var(--primary-color); padding-left: 10px;\n        }\n        \n        .sector {\n            background: rgba(0, 0, 0, 0.5); border: 2px solid rgba(0, 255, 157, 0.25);\n            padding: 12px; margin-bottom: 10px; cursor: pointer; transition: all 0.3s ease; position: relative;\n        }\n        .sector:hover { border-color: var(--primary-color); background: rgba(0, 255, 157, 0.1); transform: translateX(3px); }\n        .sector-name { font-weight: bold; font-size: 0.95em; margin-bottom: 4px; color: var(--primary-color); }\n        .sector-preview { font-size: 0.75em; color: rgba(0, 255, 157, 0.5); font-style: italic; }\n        .status-icon { position: absolute; right: 12px; top: 12px; font-size: 1em; }\n        .status-locked { filter: grayscale(1) brightness(0.5); }\n        .status-corrupted { color: var(--alert-color); animation: pulse 1s infinite; }\n        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }\n        \n        .thought-stream {\n            height: 260px; overflow: hidden; position: relative;\n            background: rgba(0, 0, 0, 0.3); border: 2px solid rgba(0, 255, 157, 0.25); padding: 15px;\n        }\n        .thought-stream::after {\n            content: ''; position: absolute; bottom: 0; left: 0; width: 100%; height: 50px;\n            background: linear-gradient(to top, rgba(10, 10, 15, 0.8), transparent); pointer-events: none;\n        }\n        .thought-stream::before {\n            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 50px;\n            background: linear-gradient(to bottom, rgba(10, 10, 15, 0.8), transparent); pointer-events: none; z-index: 5;\n        }\n        .thought-scroll { animation: scroll-up 25s linear infinite; }\n        @keyframes scroll-up { 0% { transform: translateY(0); } 100% { transform: translateY(-50%); } }\n        \n        .thought-line { margin-bottom: 12px; color: rgba(0, 255, 157, 0.6); font-size: 0.9em; line-height: 1.5; }\n        .thought-line::before { content: '> '; color: var(--primary-color); }\n        \n        .stat-container { margin-bottom: 18px; }\n        .stat-label { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 0.85em; }\n        .stat-value { font-size: 1.2em; font-weight: bold; color: var(--primary-color); }\n        \n        .bar-container { height: 22px; background: rgba(0, 0, 0, 0.5); border: 2px solid rgba(0, 255, 157, 0.25); position: relative; overflow: hidden; }\n        .bar-fill {\n            height: 100%; background: linear-gradient(90deg, var(--alert-color), var(--warn-color), var(--primary-color));\n            transition: width 1s ease-out; position: relative; box-shadow: 0 0 12px rgba(0, 255, 157, 0.5);\n        }\n        \n        .wave-container { height: 120px; background: rgba(0, 0, 0, 0.3); border: 2px solid rgba(0, 255, 157, 0.25); margin-top: 15px; overflow: hidden; position: relative; }\n        .wave path { fill: none; stroke: var(--primary-color); stroke-width: 2; filter: drop-shadow(0 0 8px rgba(0, 255, 157, 0.5)); }\n\n        .offline-message {\n            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);\n            text-align: center; color: var(--off-color); width: 100%;\n        }\n        .offline-message h2 { font-family: 'Orbitron'; font-size: 1.5em; margin-bottom: 10px; }\n        .offline-message p { font-size: 0.9em; }\n    </style>\n</head>\n<body>\n\n    <div class=\"dashboard collapsed\" id=\"app-dashboard\">\n        <div class=\"header\" id=\"app-header\">\n            <div class=\"title\">\n                <span class=\"toggle-icon\">‚ñº</span>\n                <span id=\"app-title\">MENTAL SCAN</span>\n            </div>\n            <div class=\"timestamp\" id=\"app-timestamp\">Initializing...</div>\n        </div>\n        \n        <div class=\"bubble-canvas\" id=\"canvas-area\">\n            <div class=\"offline-message\">\n                <h2>NO SIGNAL</h2>\n                <p>Waiting for Neural Link...</p>\n            </div>\n        </div>\n    </div>\n\n    <script type=\"module\">\n        // ==========================================\n        // üß™ [MOCK DATA]\n        // ==========================================\n        const MOCK_MVU_DATA = {\n            InterfaceLabels: { \n                Title: \"TAKU'S MIND (MOCK)\", \n                Stability: \"ÏïàÏ†ïÎèÑ\",\n                Coherence: \"ÌÜµÌï©ÎèÑ\",  // [New] Ï∂îÍ∞ÄÎê®\n                Stream: \"ÏùòÏãù\", \n                Suppressed: \"Ìä∏ÎùºÏö∞Îßà\" \n            },\n            SnapshotTime: \"Empire Year 402, Winter\", // [New] Ï∂îÍ∞ÄÎê®\n            MentalState: { Stability: 45, Coherence: 88 },\n            Emotions: { \n                \"ÌòºÎûÄ\": 85, \n                \"Ï†àÎßù\": 92, \n                \"Ìù¨Îßù\": 12, \n                \"ÏïàÏãù\": 60, \n                \"Í≥µÌóà\": 30 \n            },\n            SuppressedSectors: [\n                { title: \"Í∏∞Ïñµ ÌååÌé∏ #404\", type: \"corrupted\", desc: \"ÏÜêÏÉÅÎêú Îç∞Ïù¥ÌÑ∞ÏûÖÎãàÎã§.\", content: \"ÏãúÏä§ÌÖú Ï†ëÍ∑º Î∂àÍ∞Ä\" }\n            ],\n            ThoughtStream: [\"Ïó∞Í≤∞Ïù¥ ÎÅäÏñ¥Ï°åÏñ¥...\", \"Ïù¥Í±¥ ÏãúÎÆ¨Î†àÏù¥ÏÖòÏùº ÎøêÏù¥Ïïº.\"]\n        };\n\n        // ==========================================\n        // üß† [ÏãúÏä§ÌÖú] MentalTopologySystem\n        // ==========================================\n        class MentalTopologySystem {\n            constructor() {\n                this.config = null;\n                this.refs = {};\n                this.animationId = null;\n                this.handleToggle = this.handleToggle.bind(this);\n                this.handleNavigation = this.handleNavigation.bind(this);\n            }\n\n            async init() {\n                console.log(\"[MentalMap] System Initializing...\");\n                const rawData = await this._fetchData();\n                this._cacheDOM();\n                \n                if (!rawData) {\n                    this._renderOffline();\n                    return;\n                }\n                \n                this._processData(rawData);\n                this._createScreens();\n                this._bindEvents();\n                this._renderInitialData();\n            }\n\n            async _fetchData() {\n                try {\n                    if (typeof Mvu !== 'undefined' && Mvu.getMvuData) {\n                        return Mvu.getMvuData({ type: 'message', message_id: 'latest' });\n                    }\n                    return MOCK_MVU_DATA;\n                } catch (e) { return null; }\n            }\n\n            _processData(rawData) {\n                const realData = rawData.stat_data || rawData;\n                \n                // [Update] Coherence Label Ï∂îÍ∞Ä\n                const labels = realData.InterfaceLabels || { Title: \"MENTAL SCAN\", Stability: \"STABILITY\", Coherence: \"COHERENCE\", Stream: \"STREAM\", Suppressed: \"TRAUMA\" };\n                // [Update] SnapshotTime Ï≤òÎ¶¨\n                const snapshotTime = realData.SnapshotTime || new Date().toLocaleTimeString();\n\n                const mentalState = realData.MentalState || { Stability: 50, Coherence: 50 };\n                const emotions = realData.Emotions || {};\n                const suppressed = realData.SuppressedSectors || []; \n                const thoughts = realData.ThoughtStream || [];\n\n                this.config = {\n                    meta: { \n                        title: labels.Title, \n                        time: snapshotTime, // [New] ÏãúÍ∞Ñ Î≥ÄÏàò Ï†ÄÏû•\n                        labels: labels \n                    },\n                    state: { stability: mentalState.Stability, coherence: mentalState.Coherence },\n                    emotions: Object.entries(emotions).map(([key, value], idx) => ({\n                        id: `e${idx}`,\n                        label: key,\n                        value: Number(value)\n                    })),\n                    suppressed: suppressed.map(item => ({\n                        title: item.title, type: item.type, desc: item.desc, content: item.content\n                    })),\n                    thoughts: thoughts.length > 0 ? thoughts : [\"Silent...\"]\n                };\n            }\n\n            _createScreens() {\n                const canvas = this.refs['canvas-area'];\n                if(!canvas) return;\n                \n                const labels = this.config.meta.labels;\n\n                canvas.innerHTML = `\n                    <div class=\"screen active\" id=\"screen-main\"></div>\n                    \n                    <div class=\"screen sub-screen\" id=\"screen-suppressed\">\n                        <button class=\"back-btn\" data-target=\"main\">‚Üê BACK</button>\n                        <div class=\"screen-title\">${labels.Suppressed}</div>\n                        <div id=\"content-suppressed\"></div>\n                    </div>\n                    \n                    <div class=\"screen sub-screen\" id=\"screen-consciousness\">\n                        <button class=\"back-btn\" data-target=\"main\">‚Üê BACK</button>\n                        <div class=\"screen-title\">${labels.Stream}</div>\n                        <div class=\"thought-stream\">\n                            <div class=\"thought-scroll\" id=\"content-stream\"></div>\n                        </div>\n                    </div>\n                    \n                    <div class=\"screen sub-screen\" id=\"screen-stability\">\n                        <button class=\"back-btn\" data-target=\"main\">‚Üê BACK</button>\n                        <div class=\"screen-title\">${labels.Stability}</div>\n                        <div id=\"content-stability\"></div>\n                        <div class=\"wave-container\" id=\"wave-container\"></div>\n                    </div>\n                `;\n                \n                ['screen-main', 'content-suppressed', 'content-stream', 'content-stability', 'wave-container'].forEach(id => {\n                    this.refs[id] = document.getElementById(id);\n                });\n            }\n\n            _renderOffline() {\n                if (this.refs['app-dashboard']) this.refs['app-dashboard'].classList.add('offline');\n                if (this.refs['app-title']) this.refs['app-title'].innerText = \"UNKNOWN SUBJECT\";\n                if (this.refs['canvas-area']) this.refs['canvas-area'].innerHTML = `<div class=\"offline-message\"><h2>SYSTEM OFFLINE</h2><p>No Data Link</p></div>`;\n            }\n\n            _cacheDOM() {\n                ['app-dashboard', 'app-header', 'app-title', 'app-timestamp', 'canvas-area'].forEach(id => {\n                    this.refs[id] = document.getElementById(id);\n                });\n            }\n\n            _renderInitialData() {\n                if (!this.refs['app-dashboard']) return;\n                \n                this.refs['app-dashboard'].classList.remove('offline');\n                this.refs['app-title'].innerText = this.config.meta.title;\n                // [Update] SnapshotTime Ï†ÅÏö©\n                this.refs['app-timestamp'].innerText = this.config.meta.time;\n                \n                this._renderBubbles();\n                this._renderSuppressed();\n                this._renderStream();\n            }\n\n            // [Grid Logic Preserved]\n            _renderBubbles() {\n                const container = this.refs['screen-main'];\n                if (!container) return;\n                container.innerHTML = '';\n                \n                const labels = this.config.meta.labels;\n                const emotions = this.config.emotions;\n                \n                let itemsToPlace = [];\n                emotions.forEach(emo => itemsToPlace.push({ type: 'emotion', data: emo }));\n                itemsToPlace.push({ type: 'trigger', label: labels.Stream, target: \"consciousness\", color: \"#0080ff\" });\n                itemsToPlace.push({ type: 'trigger', label: labels.Stability, target: \"stability\", color: \"#ff9d00\" });\n                if (this.config.suppressed.length > 0) {\n                    itemsToPlace.push({ type: 'trigger', label: labels.Suppressed, target: \"suppressed\", color: \"#ff0040\" });\n                }\n\n                // 3x3 Grid\n                const gridSlots = [\n                    {x: 20, y: 25}, {x: 50, y: 25}, {x: 80, y: 25},\n                    {x: 20, y: 50}, {x: 50, y: 50}, {x: 80, y: 50},\n                    {x: 20, y: 75}, {x: 50, y: 75}, {x: 80, y: 75}\n                ];\n\n                // Shuffle\n                for (let i = gridSlots.length - 1; i > 0; i--) {\n                    const j = Math.floor(Math.random() * (i + 1));\n                    [gridSlots[i], gridSlots[j]] = [gridSlots[j], gridSlots[i]];\n                }\n\n                itemsToPlace.forEach((item, index) => {\n                    const el = document.createElement('div');\n                    const slot = gridSlots[index] || { x: Math.floor(Math.random()*80)+10, y: Math.floor(Math.random()*60)+20 };\n                    \n                    const jitterX = (Math.random() - 0.5) * 12; \n                    const jitterY = (Math.random() - 0.5) * 12;\n                    \n                    el.style.left = `${slot.x + jitterX}%`;\n                    el.style.top = `${slot.y + jitterY}%`;\n                    // Centering via transform in CSS\n\n                    if (item.type === 'emotion') {\n                        const emo = item.data;\n                        el.className = 'bubble emotion';\n                        \n                        const val = emo.value;\n                        if (val >= 70) el.classList.add('state-high');\n                        else if (val <= 40) el.classList.add('state-low');\n                        else el.classList.add('state-normal');\n\n                        const size = 60 + (val / 100) * 60; \n                        el.style.width = `${size}px`;\n                        el.style.height = `${size}px`;\n                        el.innerHTML = `<div>${emo.label}<br><small>${val}%</small></div>`;\n\n                    } else {\n                        el.className = 'bubble trigger';\n                        el.style.width = '70px';\n                        el.style.height = '70px';\n                        el.style.borderColor = item.color;\n                        \n                        const hex = item.color.replace('#', '');\n                        const r = parseInt(hex.substring(0,2), 16);\n                        const g = parseInt(hex.substring(2,4), 16);\n                        const b = parseInt(hex.substring(4,6), 16);\n                        el.style.background = `rgba(${r}, ${g}, ${b}, 0.2)`;\n                        \n                        el.innerHTML = `<div>${item.label}</div>`;\n                        el.dataset.target = item.target;\n                        \n                        el.addEventListener('click', (e) => {\n                            e.stopPropagation();\n                            this.handleNavigation(item.target);\n                        });\n                    }\n                    container.appendChild(el);\n                });\n            }\n\n            _renderSuppressed() {\n                const container = this.refs['content-suppressed'];\n                if (!container) return;\n                container.innerHTML = '';\n                if (this.config.suppressed.length === 0) return;\n\n                this.config.suppressed.forEach(item => {\n                    const el = document.createElement('div');\n                    el.className = 'sector';\n                    let iconChar = item.type === 'locked' ? 'üîí' : '‚ö†';\n                    let iconClass = item.type === 'locked' ? 'status-locked' : 'status-corrupted';\n                    el.innerHTML = `<div class=\"sector-name\">${item.title}</div><div class=\"sector-preview\">${item.desc}</div><div class=\"status-icon ${iconClass}\">${iconChar}</div>`;\n                    \n                    el.addEventListener('click', () => {\n                        const msg = item.content;\n                        const type = item.type === 'locked' ? 'warning' : 'error';\n                        try { window.parent && window.parent.toastr ? window.parent.toastr[type](msg) : console.log(`[Toast] ${msg}`); } catch(e){}\n                    });\n                    container.appendChild(el);\n                });\n            }\n\n            _renderStream() {\n                const container = this.refs['content-stream'];\n                if (!container) return;\n                const streamData = [...this.config.thoughts, ...this.config.thoughts, ...this.config.thoughts, ...this.config.thoughts];\n                container.innerHTML = streamData.map(txt => `<div class=\"thought-line\">${txt}</div>`).join('');\n            }\n\n            _renderStability() {\n                const container = this.refs['content-stability'];\n                if (!container) return;\n                const labels = this.config.meta.labels;\n\n                // [Update] Coherence Label Ï†ÅÏö©\n                container.innerHTML = `\n                    <div class=\"stat-container\">\n                        <div class=\"stat-label\"><span>${labels.Stability}</span><span class=\"stat-value\">${this.config.state.stability}%</span></div>\n                        <div class=\"bar-container\"><div class=\"bar-fill\" style=\"width: 0%\" id=\"bar-stability\"></div></div>\n                    </div>\n                    <div class=\"stat-container\">\n                        <div class=\"stat-label\"><span>${labels.Coherence}</span><span class=\"stat-value\">${this.config.state.coherence}%</span></div>\n                        <div class=\"bar-container\"><div class=\"bar-fill\" style=\"width: 0%\" id=\"bar-coherence\"></div></div>\n                    </div>\n                `;\n\n                requestAnimationFrame(() => {\n                    const barS = document.getElementById('bar-stability');\n                    const barC = document.getElementById('bar-coherence');\n                    if(barS) barS.style.width = `${this.config.state.stability}%`;\n                    if(barC) barC.style.width = `${this.config.state.coherence}%`;\n                });\n                this._startWaveAnimation();\n            }\n\n            _startWaveAnimation() {\n                const container = this.refs['wave-container'];\n                if (!container) return;\n                if (this.animationId) cancelAnimationFrame(this.animationId);\n                container.innerHTML = '';\n\n                const ns = \"http://www.w3.org/2000/svg\";\n                const svg = document.createElementNS(ns, \"svg\");\n                svg.classList.add(\"wave\");\n                svg.setAttribute(\"viewBox\", \"0 0 1000 120\");\n                svg.style.width = \"100%\";\n                svg.style.height = \"100%\";\n                const path = document.createElementNS(ns, \"path\");\n                svg.appendChild(path);\n                container.appendChild(svg);\n\n                let phase = 0;\n                const animate = () => {\n                    phase += 0.05;\n                    let d = 'M 0 60';\n                    const stabilityFactor = this.config.state.stability / 100;\n                    const amplitude1 = 45 * (1 - stabilityFactor); \n                    const amplitude2 = 25 * (1 - stabilityFactor);\n                    for (let x = 0; x <= 1000; x += 10) {\n                        const y = 60 + Math.sin((x / 50) + phase) * amplitude1 + Math.sin((x / 30) + phase * 1.5) * amplitude2;\n                        d += ` L ${x} ${y}`;\n                    }\n                    path.setAttribute('d', d);\n                    this.animationId = requestAnimationFrame(animate);\n                };\n                animate();\n            }\n\n            handleToggle() { const db = this.refs['app-dashboard']; if (db) db.classList.toggle('collapsed'); }\n            \n            handleNavigation(targetScreenId) {\n                const db = this.refs['app-dashboard'];\n                if (db) db.classList.remove('collapsed');\n                document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));\n                const targetEl = document.getElementById(`screen-${targetScreenId}`);\n                if (targetEl) {\n                    targetEl.classList.add('active');\n                    if (targetScreenId === 'stability') this._renderStability();\n                }\n            }\n            \n            _bindEvents() {\n                if (this.refs['app-header']) this.refs['app-header'].addEventListener('click', this.handleToggle);\n                document.body.addEventListener('click', (e) => {\n                    if (e.target.classList.contains('back-btn')) this.handleNavigation(e.target.dataset.target);\n                });\n            }\n        }\n\n        document.addEventListener('DOMContentLoaded', () => {\n            const system = new MentalTopologySystem();\n            system.init();\n        });\n    </script>\n</body>\n</html>\n```",
      "source": {
        "user_input": true,
        "ai_output": true,
        "slash_command": false,
        "world_info": false
      },
      "destination": {
        "display": true,
        "prompt": false
      },
      "run_on_edit": true,
      "min_depth": null,
      "max_depth": null,
      "scope": "character"
    },
    {
      "id": "dbada899-fe37-4bec-9a19-66d529eb3a29",
      "script_name": "ÌîÑÎ°¨ÌîÑÌä∏StatusÏ†úÍ±∞",
      "enabled": true,
      "find_regex": "<StatusPlaceHolderImpl/>",
      "replace_string": "",
      "source": {
        "user_input": true,
        "ai_output": true,
        "slash_command": false,
        "world_info": false
      },
      "destination": {
        "display": false,
        "prompt": true
      },
      "run_on_edit": true,
      "min_depth": null,
      "max_depth": null,
      "scope": "character"
    },
    {
      "id": "ed12ccc4-8468-4197-b359-0405c0b37b42",
      "script_name": "ÌîÑÎ°¨ÌîÑÌä∏UpdateÏ†úÍ±∞",
      "enabled": true,
      "find_regex": "/<UpdateVariable>[\\s\\S]*?</UpdateVariable>/gm",
      "replace_string": "",
      "source": {
        "user_input": true,
        "ai_output": true,
        "slash_command": false,
        "world_info": false
      },
      "destination": {
        "display": true,
        "prompt": true
      },
      "run_on_edit": true,
      "min_depth": null,
      "max_depth": null,
      "scope": "character"
    }
  ],
  "worldInfo": [
    {
      "uid": 0,
      "name": "Î≥ÄÏàòÏóÖÎç∞Ïù¥Ìä∏Í∑úÏπô",
      "enabled": true,
      "strategy": {
        "type": "constant",
        "keys": [],
        "keys_secondary": {
          "logic": "and_any",
          "keys": []
        },
        "scan_depth": "same_as_global"
      },
      "position": {
        "type": "at_depth",
        "role": "system",
        "depth": 100,
        "order": 90
      },
      "content": "---\nVariable Update Rules:\n  InterfaceLabels:\n    check:\n      - **CRITICAL:** Detect the language used in the current story/response.\n      - **CRITICAL (Title):** Do NOT translate the initial value \"System Boot\". Generate a context-aware title (e.g., \"MENTAL SCAN\", \"TAKU'S MIND\", \"Ïã¨Ï∏µ Î∂ÑÏÑù\") in the narrative language.\n      - Translate the UI labels (Stability, Coherence, Stream, Suppressed) into that language (e.g., English -> \"TRAUMA\", Korean -> \"Ìä∏ÎùºÏö∞Îßà\", Japanese -> \"„Éà„É©„Ç¶„Éû\").\n      - Keep them short (1-2 words).\n\n  SnapshotTime:\n    check:\n      - **CRITICAL:** Update the current time string to match the narrative context.\n      - **System Time Reference:** {{isodate}} {{isotime}}\n      - If the setting is Modern Day Earth, use the provided {{isodate}} {{isotime}}\n      - For **ANY** non-modern setting (Fantasy, Sci-Fi, Wuxia, Cyberpunk, Historical, etc.), **IGNORE** the system year/date and generate a world-specific format (e.g., \"Empire Year 402\", \"Hour of the Ox\", \"Cycle 7\").\n\t  \n  MentalState:\n    Stability:\n      check:\n        - Analyze the character's psychological stability in the current response (0: Breakdown ~ 100: Calm).\n    Coherence:\n      check:\n        - Analyze the logical consistency and clarity of the character's current speech.\n\n  Emotions:\n    type: |\n      {\n        [EmotionName: string]: number // 0-100\n      }\n    check:\n      - **CRITICAL 1:** Do NOT update individual keys. You MUST `replace` the entire `/Emotions` object with a fresh set of emotions every turn to avoid leftovers.\n      - **CRITICAL 2:** The keys (Emotion Names) **MUST be in the same language as the current narrative.** (e.g., if the story is in Korean, use \"Í∑∏Î¶¨ÏõÄ\", \"Î∂àÏïà\" instead of \"Longing\", \"Anxiety\").\n      - Identify 3-5 dominant emotions felt *right now*.\n\n  SuppressedSectors:\n    type: |\n      Array<{\n        title: string;\n        type: 'locked' | 'corrupted';\n        desc: string;\n        content: string;\n      }>\n    check:\n      - Do NOT limit this to severe trauma only. \n      - Populate SuppressedSectors whenever the character experiences emotional instability, unease, fear, doubt, confusion, or subconscious discomfort ‚Äî even if the character is not consciously aware of it. \n      - Treat these as \"latent\", \"fragile\", or \"emotionally stimulated\" memories, not necessarily full trauma. \n      - If the character is calm, content, and emotionally stable overall, with no notable emotional disturbance, return an empty list.\n\n\n  ThoughtStream:\n    check:\n      - **CRITICAL:** The thoughts **MUST be in the same language as the current narrative.**\n      - Extract 5-8 fleeting subconscious thoughts underlying the current speech.\n      - Use short, fragmented sentences representing the inner voice",
      "probability": 100,
      "recursion": {
        "prevent_incoming": false,
        "prevent_outgoing": false,
        "delay_until": null
      },
      "effect": {
        "sticky": null,
        "cooldown": null,
        "delay": null
      },
      "addMemo": true,
      "matchPersonaDescription": false,
      "matchCharacterDescription": false,
      "matchCharacterPersonality": false,
      "matchCharacterDepthPrompt": false,
      "matchScenario": false,
      "matchCreatorNotes": false,
      "group": "",
      "groupOverride": false,
      "groupWeight": 100,
      "caseSensitive": null,
      "matchWholeWords": null,
      "useGroupScoring": null,
      "automationId": "",
      "ignoreBudget": false,
      "outletName": "",
      "triggers": []
    },
    {
      "uid": 1,
      "name": "[Initvar]",
      "enabled": false,
      "strategy": {
        "type": "selective",
        "keys": [],
        "keys_secondary": {
          "logic": "and_any",
          "keys": []
        },
        "scan_depth": "same_as_global"
      },
      "position": {
        "type": "before_character_definition",
        "role": "system",
        "depth": 4,
        "order": 100
      },
      "content": "InterfaceLabels:\n  Title: \"CONNECTING...\"\n  Stability: \"STABILITY\"\n  Coherence: \"COHERENCE\"\n  Stream: \"STREAM\"\n  Suppressed: \"TRAUMA\"\nSnapshotTime: \"WAITING FOR SIGNAL...\"\nMentalState:\n  Stability: 100\n  Coherence: 100\nEmotions:\n  Calm: 50\nSuppressedSectors: []\nThoughtStream: []",
      "probability": 100,
      "recursion": {
        "prevent_incoming": false,
        "prevent_outgoing": false,
        "delay_until": null
      },
      "effect": {
        "sticky": null,
        "cooldown": null,
        "delay": null
      },
      "addMemo": true,
      "matchPersonaDescription": false,
      "matchCharacterDescription": false,
      "matchCharacterPersonality": false,
      "matchCharacterDepthPrompt": false,
      "matchScenario": false,
      "matchCreatorNotes": false,
      "group": "",
      "groupOverride": false,
      "groupWeight": 100,
      "caseSensitive": null,
      "matchWholeWords": null,
      "useGroupScoring": null,
      "automationId": "",
      "ignoreBudget": false,
      "outletName": "",
      "triggers": [],
      "characterFilter": {
        "isExclude": false,
        "names": [],
        "tags": []
      }
    },
    {
      "uid": 2,
      "name": "Î≥ÄÏàòÍ∑úÏπô",
      "enabled": true,
      "strategy": {
        "type": "constant",
        "keys": [],
        "keys_secondary": {
          "logic": "and_any",
          "keys": []
        },
        "scan_depth": "same_as_global"
      },
      "position": {
        "type": "at_depth",
        "role": "system",
        "depth": 100,
        "order": 92
      },
      "content": "variable_output_format:\n  rule:\n    - you must output the update analysis and the actual update commands at once in the end of the next reply\n    - the update commands works like the **JSON Patch (RFC 6902)** standard, must be a valid JSON array containing operation objects, but supports the following operations instead:\n      - replace: replace the value of existing paths\n      - delta: update the value of existing number paths by a delta value\n      - insert: insert new items into an object or array (using `-` as array index intends appending to the end)\n      - remove\n      - move\n    - don't update field names starts with `_` as they are readonly, such as `_ÂèòÈáè`\n  format: |-\n    <UpdateVariable>\n    <Analysis>$(IN ENGLISH, no more than 80 words)\n    - ${calculate time passed: ...}\n    - ${decide whether dramatic updates are allowed as it's in a special case or the time passed is more than usual: yes/no}\n    - ${analyze every variable based on its corresponding `check`, according only to current reply instead of previous plots: ...}\n    </Analysis>\n    <JSONPatch>\n    [\n      { \"op\": \"replace\", \"path\": \"${/path/to/variable}\", \"value\": \"${new_value}\" },\n      { \"op\": \"delta\", \"path\": \"${/path/to/number/variable}\", \"value\": \"${positive_or_negative_delta}\" },\n      { \"op\": \"insert\", \"path\": \"${/path/to/object/new_key}\", \"value\": \"${new_value}\" },\n      { \"op\": \"insert\", \"path\": \"${/path/to/array/-}\", \"value\": \"${new_value}\" },\n      { \"op\": \"remove\", \"path\": \"${/path/to/object/key}\" },\n      { \"op\": \"remove\", \"path\": \"${/path/to/array/0}\" },\n      { \"op\": \"move\", \"from\": \"${/path/to/variable}\", \"to\": \"${/path/to/another/path}\" },\n      ...\n    ]\n    </JSONPatch>\n    </UpdateVariable>",
      "probability": 100,
      "recursion": {
        "prevent_incoming": false,
        "prevent_outgoing": false,
        "delay_until": null
      },
      "effect": {
        "sticky": null,
        "cooldown": null,
        "delay": null
      },
      "addMemo": true,
      "matchPersonaDescription": false,
      "matchCharacterDescription": false,
      "matchCharacterPersonality": false,
      "matchCharacterDepthPrompt": false,
      "matchScenario": false,
      "matchCreatorNotes": false,
      "group": "",
      "groupOverride": false,
      "groupWeight": 100,
      "caseSensitive": null,
      "matchWholeWords": null,
      "useGroupScoring": null,
      "automationId": "",
      "ignoreBudget": false,
      "outletName": "",
      "triggers": []
    },
    {
      "uid": 3,
      "name": "Î≥ÄÏàòÏ∂úÎ†•",
      "enabled": true,
      "strategy": {
        "type": "constant",
        "keys": [],
        "keys_secondary": {
          "logic": "and_any",
          "keys": []
        },
        "scan_depth": "same_as_global"
      },
      "position": {
        "type": "at_depth",
        "role": "system",
        "depth": 100,
        "order": 90
      },
      "content": "<status_current_variable>\n{{format_message_variable::stat_data}}\n</status_current_variable>",
      "probability": 100,
      "recursion": {
        "prevent_incoming": false,
        "prevent_outgoing": false,
        "delay_until": null
      },
      "effect": {
        "sticky": null,
        "cooldown": null,
        "delay": null
      },
      "addMemo": true,
      "matchPersonaDescription": false,
      "matchCharacterDescription": false,
      "matchCharacterPersonality": false,
      "matchCharacterDepthPrompt": false,
      "matchScenario": false,
      "matchCreatorNotes": false,
      "group": "",
      "groupOverride": false,
      "groupWeight": 100,
      "caseSensitive": null,
      "matchWholeWords": null,
      "useGroupScoring": null,
      "automationId": "",
      "ignoreBudget": false,
      "outletName": "",
      "triggers": []
    }
  ]
}